<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="UTF-8">
  
<title>Oak Bluffs Historic Highlands Map</title>
  
<!--jquery js-->
<script src="https://code.jquery.com/jquery-3.5.1.js" integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc=" crossorigin="anonymous"></script>




<!--jQuery UI files-->
<link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css" />
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js" integrity="sha256-T0Vest3yCU7pafRw9r+settMBX6JkKN06dqBnpQ8d30=" crossorigin="anonymous"></script>

<!--jQuery UI Touch js, required for touchscreen use-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui-touch-punch/0.2.3/jquery.ui.touch-punch.min.js"></script>
  
<!--leaflet files-->
 <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A==" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js" integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA==" crossorigin=""></script>

  
<!--other js files-->
<script src="js/leaflet-sidebar.js"></script>
<script src="https://unpkg.com/leaflet.tilelayer.mbtiles@latest/Leaflet.TileLayer.MBTiles.js"></script>
<script src="https://unpkg.com/sql.js@0.3.2/js/sql.js"></script>
<script type="text/javascript" src="js/L.Control.ZoomBar.js"></script>
<script src="js/SliderControl.js"></script>
<script src="js/leaflet-search.src.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@turf/turf@6.5/turf.min.js"></script>



<!--other css files-->
<link rel="stylesheet" href="css/leaflet-sidebar.css"/>
<link rel="stylesheet" href="css/general.css"/>
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet" />
<link rel="stylesheet" href="css/L.Control.ZoomBar.css"/>
<link rel="stylesheet" href="css/SliderControl.css"/>
<link rel="stylesheet" href="css/leaflet-search.src.css"/>
<link rel="stylesheet" href="css/form-style.css"/>


  
<style>
html, body {
			height: 100%;
			margin: 0;
		}
  
#map {
  width: 100%;
  height: 100%;
}

</style>

  <script>
  window.console = window.console || function(t) {};
</script>

  
  
  <script>
  if (document.location.search.match(/type=embed/gi)) {
    window.parent.postMessage("resize", "*");
  }
</script>

</head>


<body>
<div id="map"></div>

<div id="sidebar" class="leaflet-sidebar collapsed">
        <!-- Nav tabs -->
        <div class="leaflet-sidebar-tabs">
            <ul role="tablist">
                <li><a href="#home" role="tab"><i class="fa fa-bars center"></i></a></li>
                <li><a href="#instructions" role="tab"><i class="fa fa-info"></i></a></li>
                <li><a href="#citations" role="tab"><i class="fa fa-bookmark"></i></a></li>
                <li><a href="#messages" role="tab"><i class="fa fa-envelope"></i></a></li>
                <li><a href="#settings" role="tab"><i class="fa fa-gear"></i></a></li>
            </ul>
        <!-- add more tab panes here, copy / paste -->   
        </div>

        <!-- Tab panes -->
        <div class="leaflet-sidebar-content">
            <div class="leaflet-sidebar-pane" id="home">
                <h1 class="leaflet-sidebar-header">
                    The History of Property Ownership in the Highlands
                    <br> 
                    <span class="leaflet-sidebar-close"><i class="fa fa-caret-left"></i></span>
                </h1>

                

                <p class="lorem">For the Oak Bluffs Historic Highlands project, I have built the framework for a map that uses publicly available deed documents to represent the history of landownership in the Highlands area of Oak Bluffs, Massachusetts, a resort town on the island of Martha’s Vineyard. Oak Bluffs has historically been a pluralistic, multi-ethnic and multi-racial, summer resort community with numerous year-round residents, famously noted for being a popular place for African American vacationers<sup>1</sup>. 
                  <br>
                  <br>
                  The web-based map spatializes, or represents visually in geographic space, 19th and 20th century paper property records held in the local registry of deeds. Spatializing these records allows users to view aspects of the Highlands community at different points in time, including the size of the community, distribution of occupied lots, and eventually the hometown of owners, and sale / purchase prices. In future version of this map deed records will be combined with census records, and when available, probate records to provide additional information on individuals and families and the community itself. 
                    <br>
                    <br>
                    The Highlands area in Oak Bluffs was mapped and divided into small 70-foot by 30-foot parcels in 1870 by investors hoping to build a densely populated, thriving, and for them, highly profitable, summer vacation community centered around Methodist summer revivals. But the Methodists never moved their revivals to the Highlands and the economic depression of 1873 meant that property sales were slow. Instead, the investors made a deal with a smaller Baptist organization to hold revivals and the community grew slowly over time, with a mix of summer homes and larger institutions. 
                    <br>
                    <br>
                    The trends in this neighborhood indicate that the earliest residents were predominantly white Americans from Massachusetts, Rhode Island, Connecticut, and New York, including Baptist preachers and their families. The Baptist Revivals held there introduced new residents to Oak Bluffs and the Highlands community and by the first decade of the 20th century it had gained a reputation as being a place where Black vacationers could own property, rent homes, and stay in hotels or inns, a reputation that still stands today<sup>1</sup>. 
                    <br>
                    <br>
                    The overall goal of the Oak Bluff’s Historic Highlands project is to make the history of property ownership in the Highlands visible and accessible the present-day community, descendant community members, and community heritage experts, like the African American Heritage Trail of Martha’s Vineyard, the Oak Bluffs Polar Bears, and the Cottagers. Users of the map can explore how the community grew and changed over time, explore this history of the property their family owns, or view where their friends and family lived in the past. 
                    <br>
                    <br>
                    The map is designed to facilitate conversations about these histories, answer questions about property ownership and land transfers, and, eventually, to record memories shared through these discussions. As secondary goal of the map is to facilitate conversations about cultural heritage, preservation, and initiate conversations about utilizing archaeology as another tool with which the community can preserve, learn about, and share its history.
                    <br>
                  </p>
                

            </div>

            <div class="leaflet-sidebar-pane" id="instructions">
                <h1 class="leaflet-sidebar-header">Instructions<span class="leaflet-sidebar-close"><i class="fa fa-information"></i></span></h1>
		            <p class="lorem">The map was built using Leafletsjs, an opensource JavaScript library for creating web mapping services and projects. After opening the map users will see the full extend of the lots owned and lived on since the Highlands area was subdivided in 1870. For the test version this is only thirty lots. 
                    <br>
                    <br>
                    Users will be able to interact with the map by adjusting the time slider to view the community at a specific time span, clicking on lots to reveal popup with additional information, use the search box to find specific lots or individuals, and switch the historic map layer on and off. Users can also follow a link in each popup to a webpage the provides detailed histories on each lot, the people who owned or lived at them. There is a test version of this webpage attached to Lot 4. As the goal of this project was to develop a test version of a later map there is a considerable amount of missing data. Now that the framework has been completed, the next steps are to scale up the map with more data on each lot and to add additional data beyond deed records. The final version of this map will include information on hundreds of lots from 1870 – 1950 and will live on the website of the African American Heritage Trail of Martha’s Vineyard.
                    <br>
                    <br>
                    his map was made by Jeffrey Burnett, PhD Student at Michigan State University during the author's 2021-2022 CHI fellowship. The author worked with the African American Trail of Martha's Vineyard, the Dukes County Registry of Deeds, CHI director Ethan Watrall, and CHI fellows and alumni to produce this map. This is a trial version of a future map licensed under a Creative Commons Attribution-ShareAlike 4.0 International License.
                    <br>
                </p>
            </div>
                
            <div class="leaflet-sidebar-pane" id="citations">
                <h1 class="leaflet-sidebar-header">References<span class="leaflet-sidebar-close"><i class="fa fa-caret-left"></i></span></h1>
		  <br>
      <ol>
          <li>Cromwell, "The History of Oak Bluffs as a Popular Resort for Blacks," Dukes County Intelligencer 26, no. 1 (August 1984)</li>
          <li>Cromwell 1984; Robert C. Hayden, <i>African-Americans on Martha's Vineyard & Nantucket: A history of people, places and events</i>, Select Publications, 1999; Jocelyn Coleman Walton, “Life in the Highlands,” Martha’s Vineyard Magazine, 2016; Elaine Cawley Weintraub, <i>Lighting the Trail: The African American Heritage of Martha's Vineyard</i>, 2015.</li>
		  
		  </ol>
            </div>

            <div class="leaflet-sidebar-pane" id="messages">
                <h1 class="leaflet-sidebar-header">Messages<span class="leaflet-sidebar-close"><i class="fa fa-caret-left"></i></span></h1>
		    <p><b><a class="one" href="mailto:fadat85580@nefacility.com" target="_blank">Contact Us!</a></b></p>
            </div>

            <div class="leaflet-sidebar-pane" id="settings">
                <h1 class="leaflet-sidebar-header">Settings<span class="leaflet-sidebar-close"><i class="fa fa-caret-left"></i></span></h1>
            </div>
        </div>
    </div>
    

      <script id="rendered-js" >
var basemap_color = 'https://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png';
var basemap_satellite = 'https://api.maptiler.com/tiles/satellite-v2/{z}/{x}/{y}.jpg?key=kUPH9bhggOn8sGeOtVCW';
var overlay_1890 = 'https://map-tile.server.burne138.msu.domains/Plan_Map_of_the_Highlands_1890_best_imagery_4326_largest/{z}/{x}/{y}.png';


var map = L.map('map', {
    editable: true,
    minZoom: 11,
    maxZoom: 19.5,
    zoomControl: false}).setView([41.461070584121636, -70.56516015402862], 16);
    map.setMaxBounds(map.getBounds());

map.attributionControl.addAttribution('<a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons License" style="border-width:0; max-width:60px; vertical-align: bottom" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" /></a>');

var basemapLayerColor = L.tileLayer(basemap_color, {
  noWrap: true,
  minZoom: 11,
  maxZoom: 20,
  attribution: '<div id="content-attribution">&copy; <a href="https://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a> </div>'
}).addTo(map);

var basemapLayerSatellite = L.tileLayer(basemap_satellite,{
        noWrap: true,
        tileSize: 512,
        zoomOffset: -1,
        maxZoom: 20,
        minZoom: 11,
        attribution: '<div id="content-attribution">&copy; <a href="https://www.maptiler.com/" target="_blank">MapTiler</a> contributors JJB |</div>',
        crossOrigin: true
      }).addTo(map);

var overlayLayer1890 = L.tileLayer(overlay_1890, {
  noWrap: true,
  maxZoom: 20,
    minZoom: 11,
  opacity: 0.6,
  attribution: '<div id="content-attribution">Historic Map, <a href="https://collections.leventhalmap.org/search/commonwealth:x059cd109" target="_blank">Boston Public Library Norman B. Leventhal Map Center</div>',
}).addTo(map);

var baseMaps = {
    "Satellite": basemapLayerSatellite,
    "Standard": basemapLayerColor
   };

var overlayMaps = {
    "Historic Map": overlayLayer1890
};

var mql = window.matchMedia('(max-width:991px)');

let mobileView = mql.matches;    

var mobileZoomBox =  L.Control.extend({

options: {
  position: 'topright'
},
 
onAdd: function (map) {
  var container = L.DomUtil.create('div');
  container.type="div";
  container.title="Mobile Zoom Box";
  container.textContent = 'Pinch To Zoom';
  
  container.style.backgroundColor = 'white';
  container.style.fontSize = "22px";
  container.style.fontWeight = "700";
  container.style.textAlign = "center";
  container.style.backgroundSize = "100px 65px";
  container.style.width = '100px';
  container.style.height = '65px';
  

  return container;
}
});

if (mobileView) {
    map.addControl(new mobileZoomBox());;
} else {
    var zoom_bar = new L.Control.ZoomBar({position: 'topright'}).addTo(map);
}


L.control.layers(baseMaps, overlayMaps).addTo(map);

var infoDesktop = L.control();
var infoMobile = L.control();

infoDesktop.onAdd = function (map) {
    this._div = L.DomUtil.create('div', 'info'); // create a div with a class "info"
    this.update();
    return this._div;
};

infoMobile.onAdd = function (map) {
    this._div = L.DomUtil.create('div', 'info'); // create a div with a class "info"
    this.update();
    return this._div;
};

// method that we will use to update the control based on feature properties passed
infoDesktop.update = function (props) {
        this._div.innerHTML = '<div id="content-desktop"><h3>Lot Information</h3>' +  (props ?
        '<b>' + 'Lot #' + props.lot_number + ' owned by ' + props.grantee + ' starting on ' + props.time
        : 'Hover over a lot</div>');
    };
    
infoMobile.update = function (props) {
        this._div.innerHTML = '<div id="content-mobile"><h2>Lot Information</h2>' +  (props ?
        '<b>' : '<h3>Click on a lot</h3></div>');
        };

if (mobileView) {
    infoMobile.addTo(map);
} else {
    infoDesktop.addTo(map);
}


function style(feature) {
		return {
			weight: 2,
			opacity: 1,
			color: 'black',
			dashArray: '3',
			fillOpacity: 0.5,
			fillColor: '#009e73',
		};
	}

function highlightFeature(e) {
	var layer = e.target;

	layer.setStyle({
		weight: 5,
    fillColor: '#f0e442',
		color: '#666',
		dashArray: '',
		fillOpacity: 0.7
	});

	if (!L.Browser.ie && !L.Browser.opera && !L.Browser.edge) {
		layer.bringToFront();
	};

	infoDesktop.update(layer.feature.properties);
	infoMobile.update(layer.feature.properties);
}

var polygons
	
	function resetHighlight(e) {
		polygons.resetStyle(e.target);
		infoDesktop.update();
		infoMobile.update();
	}

  function zoomToFeature(e) {
  map.fitBounds(e.target.getBounds());
  var point = turf.point([e.latlng.lng, e.latlng.lat]);
  var content = '';
  polygons.eachLayer(function(layer) {
    var feature = layer.feature;
    if (turf.booleanPointInPolygon(point, feature)) {
      content += "<div style='clear: both'></div><div><h4>" + 'Lot number ' + feature.properties.lot_number + "</h4><center><img src='images/" + feature.properties.picture + "' style='width:200px;height:300x;'></center><p>" + feature.properties.time + "</p><p>" + feature.properties.grantee + "</p><a href='" + feature.properties.link + "' target='_blank'>" + "Click here for more info" + "</a>" + "</p></div>";
    }
  });
  L.popup({
    maxHeight: 400,
    minWidth: 220,
    keepInView: true,    
  })
    .setLatLng(e.latlng)
    .setContent(content)
    .openOn(map);
    
}

function onEachFeature (feature, layer) {
  layer.on({
    mouseover: highlightFeature,
    mouseout: resetHighlight,
    click: zoomToFeature,
  });
  

    
	var content = "<div style='clear: both'></div><div><h4>" + 'Lot number ' + feature.properties.lot_number + "</h4><center><img src='images/" + feature.properties.picture + "' style='width:200px;height:300x;'></center> <br><p>" + feature.properties.time + "</p><p>" + feature.properties.grantee + "</p><a href='" + feature.properties.link + "' target='_blank'>" + "Click here for more info" + "</a>" + "</p></div>";
	var p = layer.feature.properties;
    p.index = "Lot " + p.lot_number + " | " + p.grantee + " | " + p.time;
    };


    $.getJSON("data/test_polygon_wgs84_5.geojson", function (json){
// add GeoJSON layer to the map once the file is loaded
   polygons = L.geoJson(json ,{
	    style: style,
        onEachFeature: onEachFeature,
        });map.fitBounds(polygons.getBounds());

// Set the sliderControl options
    var sliderControl = L.control.sliderControl({
        layer: polygons, //REQUIRED
        alwaysShowDate: true,
        range: true,
        sameDate: true,
        showAllPopups: false, // to show all popups, instead of one, same as popup option "autoClose: false"
        showPopups: false, // to set it so, when a marker is generated by the slider, its popup doesn't automatically display
        showAllOnStart: true        
    });



    var searchControl = new L.Control.Search({
		layer: polygons,
		propertyName: 'index',
        marker: false,
		moveToLocation: function(latlng, title, map) {
			//map.fitBounds( latlng.layer.getBounds() );
			var zoom = map.getBoundsZoom(latlng.layer.getBounds());
  			map.setView(latlng, zoom); // access the zoom
		}
});        

searchControl.on('search:locationfound', function(e) {
		
		//console.log('search:locationfound', );

		//map.removeLayer(this._markerSearch)

		e.layer.setStyle({fillColor: '#3f0', color: '#0f0'});
		if(e.layer._popup)
			e.layer.openPopup();

	}).on('search:collapsed', function(e) {

		polygons.eachLayer(function(layer) {	//restore feature color
			polygons.resetStyle(layer);
		});	
});
	
map.addControl( searchControl );  //inizialize search control
    
// Add the slider to the map
map.addControl(sliderControl);

// Initialize the slider
sliderControl.startSlider();

});

var sidebar = L.control.sidebar({ container: 'sidebar' })
            .addTo(map)
            .open('home');

</script>

  

</body>

</html>
